version: '3.8'

# ===========================================
# DEVELOPMENT ENVIRONMENT OVERRIDES
# ===========================================
# Usage: docker compose -f docker-compose.yml -f docker-compose.dev.yml --env-file .env.dev up
# Or: make dev-up
# ===========================================

services:
  postgres-user:
    environment:
      POSTGRES_DB: movie_hub_user_dev
    ports:
      - "5434:5432"
    volumes:
      - postgres_user_data_dev:/var/lib/postgresql/data

  postgres-movie:
    environment:
      POSTGRES_DB: movie_hub_movie_dev
    ports:
      - "5435:5432"
    volumes:
      - postgres_movie_data_dev:/var/lib/postgresql/data

  user-service:
    environment:
      NODE_ENV: development
      DATABASE_URL: postgresql://${USER_DB_USER:-postgres}:${USER_DB_PASSWORD}@postgres-user:5432/movie_hub_user_dev?schema=public
    volumes:
      - ./apps/user-service/src:/app/apps/user-service/src
      - /app/node_modules
    ports:
      - "3011:3001"

  movie-service:
    environment:
      NODE_ENV: development
      DATABASE_URL: postgresql://${MOVIE_DB_USER:-postgres}:${MOVIE_DB_PASSWORD}@postgres-movie:5432/movie_hub_movie_dev?schema=public
    volumes:
      - ./apps/movie-service/src:/app/apps/movie-service/src
      - /app/node_modules
    ports:
      - "3012:3002"

  api-gateway:
    environment:
      NODE_ENV: development
    volumes:
      - ./apps/api-gateway/src:/app/apps/api-gateway/src
      - /app/node_modules
    ports:
      - "3010:3000"

  web:
    environment:
      NODE_ENV: development
    volumes:
      - ./apps/web/src:/app/apps/web/src
      - /app/node_modules
    ports:
      - "4200:4200"

volumes:
  postgres_user_data_dev:
    name: moviehub_postgres_user_dev
  postgres_movie_data_dev:
    name: moviehub_postgres_movie_dev
