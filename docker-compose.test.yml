version: '3.8'

# Test Environment - Isolated test databases
services:
  postgres-user:
    environment:
      POSTGRES_DB: movie_hub_user_test
    ports:
      - "5436:5432"
    volumes:
      - postgres_user_data_test:/var/lib/postgresql/data

  postgres-movie:
    environment:
      POSTGRES_DB: movie_hub_movie_test
    ports:
      - "5437:5432"
    volumes:
      - postgres_movie_data_test:/var/lib/postgresql/data

  user-service:
    environment:
      NODE_ENV: test
      DATABASE_URL: postgresql://${USER_DB_USER:-postgres}:${USER_DB_PASSWORD}@postgres-user:5432/movie_hub_user_test?schema=public
    ports:
      - "3021:3001"

  movie-service:
    environment:
      NODE_ENV: test
      DATABASE_URL: postgresql://${MOVIE_DB_USER:-postgres}:${MOVIE_DB_PASSWORD}@postgres-movie:5432/movie_hub_movie_test?schema=public
    ports:
      - "3022:3002"

  api-gateway:
    environment:
      NODE_ENV: test
    ports:
      - "3020:3000"

  web:
    environment:
      NODE_ENV: test
    ports:
      - "4201:4200"

volumes:
  postgres_user_data_test:
    name: moviehub_postgres_user_test
  postgres_movie_data_test:
    name: moviehub_postgres_movie_test